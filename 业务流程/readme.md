### 业务流程

下面写的是关于对工作流引擎和流程的笔记，尚未整理完成







wiki上的自定义流程部如下👇：

##### 1.流程部署表deployments是用来保存文字内容和图片那些资源，是资源表

##### 2.流程定义表procedure_definitions类似于类，流程实例表procedure_instances就像是它生产的对象（实例表有外键关联定义表）

##### 3.流程实例表procedure_instances有个外键关联流程定义表

##### 4.流程任务表run_tasks，流程在运行过程中所产生的任务数据保存在run_task表中。有两个外键，一个关联流程定义表，一个关联流程实例表

##### 5.流程参数表run_variables，存放流程中的参数，这类参数包括流程实例参数、执行流参数和任务参数，参数有可能会有多种类型，因此该表使用多个字段来存放参数值。有个外键关联流程实例表

##### 6.流程与身份关系表run_identity_links，用户或者用户组与流程数据之间的关系，使用run_identity_link来保存。有个两个外键，一个关联流程实例表，一个关联流程定义表。

##### 7.事件描述表events，如果流程到达某类事件节点，BPMN会往event表中加入事件描述数据，这些事件描述数据将会决定流程事件的触发。有个两个外键，一个关联流程实例表，一个关联流程定义表。





##### 业务是描述一个逻辑功能，流程是用流程语言描述的业务实现的具体动作。

![image-20210122163917456](pictures\image-20210122163917456.png)













**业务对象用来承载、持久化业务数据；表单则是业务数据的展示层；流程则用来驱动业务数据流转。**

👇

- 这种⚪的是事件(Event)，有开始事件和结束事件；中间方的是任务(Task)；全部合起来就是一个流程，整张图(bpmn)也就是流程定义

- 流程图bpmn（即流程定义）本质上是xml文件

- 流程定义部署，实际上是将流程定义里面的数据部署到activity的三张数据库表里面去。要把流程定义部署进流程部署表之后才能产生流程实例

- HI表代表是历史表

  - HI表中名字是pro开头代表的是流程表

  - HI表中名字是act开头代表的是活动表hi_actinst【即Event+Task合并的表】，当完成complete了一个任务实例的时候，这个表就会多出下一个需要完成的任务实例【但此时END_TIME_是NULL，因为尚未complete】;**任务联系人表hi_identitylink**也会出现下一条记录。

  - 流程实例可以反过来查询到流程定义，但查不了流程部署；流程定义可以查到流程部署

  - 任务(Task)要完成complete之后才算结束，**历史任务实例表hi_taskinst**对应的任务实例才会出现END_TIME_的值，然后此时**历史任务实例表hi_taskinst**会出现下一个需要执行的任务实例；但如果不complete那就是NULL且表不会出现下一条任务。

- RU表都是正在运行的表

  - ru_task是当前正在运行任务的表，当前任务完成即被complete后，就会把当前任务记录删除，然后插入下一个任务的数据。如果全部已经执行完了那就整个表为空了
  - ru_excution是记录了流程中所有运行过【包括正在运行的】的任务，当整个流程结束后【即达到了结束事件】整个表就会清空；同理ru_identitylink也是一样。
  - 总结：当整个流程结束后，ru_task，ru_excution和ru_identitylink都空了
  - 业务主键ru_business在ru_execution表中



- GE表是通用资源文件
  - ge_bytearray表是放bpmn文件和png文件数据记录的，两个一起放。
  - ge_property表是记录引擎信息，这个表一般不会改变









补图：

![image-20210126152050452](pictures\image-20210126152050452.png)

![image-20210126153808688](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210126153808688.png)

